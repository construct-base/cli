package {{.PackageName}}

import (
    "base/app/models"
    "base/core/module"
    "base/core/logger"
    "base/core/router"
    "base/core/storage"
    "base/core/emitter"{{if .HasTranslatableFields}}
    "base/core/translation"{{end}}

    "gorm.io/gorm"
)

type Module struct {
    module.DefaultModule
    DB         *gorm.DB
    Service    *{{.Service}}
    Controller *{{.Controller}}{{if .HasTranslatableFields}}
    TranslationHelper *translation.Helper{{end}}
}

// Init creates and initializes the {{.Model}} module with all dependencies
func Init(deps module.Dependencies) module.Module {
    {{if .HasTranslatableFields}}// Create translation service and helper
    translationService := translation.NewTranslationService(deps.DB, deps.Emitter, deps.Storage, deps.Logger)
    translationHelper := translation.NewHelper(translationService)
    
    // Initialize service with translation helper
    service := New{{.Service}}(deps.DB, deps.Emitter, deps.Storage, deps.Logger, translationHelper){{else}}// Initialize service and controller
    service := New{{.Service}}(deps.DB, deps.Emitter, deps.Storage, deps.Logger){{end}}
    controller := New{{.Controller}}(service, deps.Storage)
    
    // Create module
    mod := &Module{
        DB:         deps.DB,
        Service:    service,
        Controller: controller,{{if .HasTranslatableFields}}
        TranslationHelper: translationHelper,{{end}}
    }
    
    return mod
}

// Routes registers the module routes
func (m *Module) Routes(router *router.RouterGroup) {
    m.Controller.Routes(router)
}

func (m *Module) Init() error {
    return nil
}

func (m *Module) Migrate() error {
    return m.DB.AutoMigrate(&models.{{.Model}}{}{{range .Fields}}{{if or (eq .Relationship "many_to_many") (eq .Relationship "manyToMany") (eq .Relationship "toMany") (eq .Relationship "to_many") (eq .Type "to_many") }}, &models.{{$.Model}}{{.RelatedModel}}{}{{end}}{{end}})
}

func (m *Module) GetModels() []any {
    return []any{
        &models.{{.Model}}{},{{range .Fields}}{{if or (eq .Relationship "many_to_many") (eq .Relationship "manyToMany") (eq .Relationship "toMany") (eq .Relationship "to_many") (eq .Type "to_many")}}
        &models.{{$.Model}}{{.RelatedModel}}{},{{end}}{{end}}
    }
}